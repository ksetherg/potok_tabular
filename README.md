# Второе решение команды DuoBand
# How-Tos

- **Use**:
    
    `pip install poetry`
    
    `poetry install`
- **Run**:

- `Положить файлы X_train.csv, X_test.csv в папку models`

- `poetry run python models/main.py`

# Постановка задач
- Классифицировать фродовые транзакции

# Описание данных
`eventTime` - время совершения транзакции

`cardToken` - аналог номера карты,  идентифицирует клиента

`providerId` - хешированый идентификатор банка, через который делается платеж

(`partyId`, `shopId`) - пара идентификатор магазина, в котором происходит платеж

`bin_hash` - хешированые первые 6 цифр карты

`ms_pan_hash` - хешированные последние 4 цифры карты

`amount` - сумма платежа 

`currency` - валюта платежа

`paymentSystem` - платежная система

`bankCountry` - страна банка, выпустившего карту


# Описание решения

- Предобработка данных
  - Убраны дубликаты по (`eventTime`, `cardToken`)
  - Найден `providerId` от которого весь трафик фродовый `23759997b3c59884dc4c0ff5320d6301b0e7f63bf0f6483a7b54d7d43bc5ccd1`
  - Найден `bin_hash` от которого большинство трафика фрод `aefb8cf11eedb0899f8b413f90cf20ebaaedcf5d300c95cceea3c924`
- Пайплайн
  - Создаем новые фичи, используя время сделки, сумму сделки и категориальные фичи
    - Количество сделок до текущей сделки сначала дня
    - Сумма сделок до текущей сделки сначала дня
    - Среднее время между до текущей сделки сделками сначала дня
    - Количество уникальных категориальных фич до текущей сделки сначала дня
  - Категориальные фичи [`currency`, `paymentSystem`, `bankCountry`] кодируем с помощью `CatBoostEncoder`, остальные не используем, т.к. они ведут к переобучению
  - Используем для обучения и валидации модели `StratifiedKFold` с 5 фолдами
  - В качестве алгоритма машинного обучения взяли `LighGBMClassifier`
- Результаты на валидации
  - `F1Score` 0.62
  - `RocAuc` 0.8
  - `TP` = 1364, `FP` = 815, `FN` = 864, `TN` = 156800

# Проблемы

- Мало данных, разнообразие фрода невелико
- На данном датасете в такой постановке задачи лучше сработает набор правил и списки блеклистов